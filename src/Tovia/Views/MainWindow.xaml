<Window x:Class="Tovia.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Tovia"
        xmlns:converters="clr-namespace:Tovia.Converters"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        mc:Ignorable="d"
        WindowStartupLocation="CenterScreen"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        TextElement.FontWeight="Regular"
        TextElement.FontSize="13"
        TextOptions.TextFormattingMode="Ideal"
        TextOptions.TextRenderingMode="Auto"
        FontFamily="{DynamicResource MaterialDesignFont}"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="CanResizeWithGrip"
        Closed="MainWindow_Closed"
        Height="640"
        Width="640">
    <Window.Resources>
        <converters:InverseBooleanToVisibilityConverter x:Key="InverseBoolToVis" />
        <converters:StringToVisibilityHiddenConverter x:Key="StringToVisibilityHiddenConverter" />
        <converters:StringToVisibilityCollapsedConverter x:Key="StringToVisibilityCollapsedConverter" />
        <BooleanToVisibilityConverter x:Key="BoolToVis" />
    </Window.Resources>

    

    <Border BorderBrush="WhiteSmoke"
            BorderThickness="1"
            CornerRadius="0"
            Background="{DynamicResource MaterialDesignPaper}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="32"/>
                <RowDefinition />
            </Grid.RowDefinitions>
            <DockPanel Grid.Row="0"
                       Background="{DynamicResource OutlookHeaderBackgroundBrush}"
                       MouseLeftButtonDown="TitleBar_MouseDown">
                <Image Source="pack://application:,,,/Assets/Icons/Tovia_Logo_3.png"
                       Height="48"
                       HorizontalAlignment="Left"
                       VerticalAlignment="Center"
                       RenderOptions.BitmapScalingMode="HighQuality" />
                <StackPanel Orientation="Horizontal"
                        HorizontalAlignment="Right">
                    <Button Width="40"
                            Height="32"
                            Click="Minimize_Click"
                            FontFamily="Segoe MDL2 Assets"
                            Content="&#xE921;"
                            Style="{StaticResource IconButtonStyle}"/>

                    <Button Width="40"
                            Height="32"
                            Click="Maximize_Click"
                            FontFamily="Segoe MDL2 Assets"
                            Content="&#xE922;"
                            Style="{StaticResource IconButtonStyle}"/>

                    <Button Width="40"
                            Height="32"
                            Click="Close_Click"
                            FontFamily="Segoe MDL2 Assets"
                            Content="&#xE8BB;"
                            Style="{StaticResource IconButtonStyle}"/>


                </StackPanel>
            </DockPanel>
            <materialDesign:DialogHost Identifier="RootDialog"
                                   DialogContentUniformCornerRadius="0"
                                   DialogTheme="Inherit"
                                       Grid.Row="1">
            <Grid>

                <Grid.RowDefinitions>
                    <RowDefinition Height="auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!--Header Section Login-->
                <Border Grid.Row="0"
                        Background="{DynamicResource OutlookHeaderBackgroundBrush}"
                        BorderThickness="0 0 0 1">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>


                        <materialDesign:PopupBox VerticalAlignment="Center"
                                                 Grid.Column="1"
                                                 materialDesign:RippleAssist.Feedback="Transparent"
                                                 HorizontalAlignment="Right"
                                                 Margin="0,0,12,0"
                                                 Padding="8"
                                                 Foreground="{DynamicResource OutlookHeaderForegroundBrush}"
                                                 PlacementMode="BottomAndAlignRightEdges"
                                                 StaysOpen="False">
                            <materialDesign:PopupBox.ToggleContent>
                                <StackPanel Orientation="Horizontal"
                                            VerticalAlignment="Center">
                                    <Image Source="{Binding AuthorizationVM.AccountPhoto}"
                                           Width="32"
                                           Height="32"
                                           Stretch="UniformToFill"
                                           RenderOptions.BitmapScalingMode="HighQuality"
                                           Margin="4">
                                        <Image.Clip>
                                            <EllipseGeometry Center="16,16"
                                                             RadiusX="16"
                                                             RadiusY="16" />
                                        </Image.Clip>
                                    </Image>

                                    <TextBlock Text="{Binding AuthorizationVM.AccountUsername}"
                                               VerticalAlignment="Center"
                                               Foreground="{DynamicResource OutlookHeaderForegroundBrush}"
                                               Style="{StaticResource MaterialDesignBody1TextBlock}" />

                                    <Path Data="M 0 0 L 4 4 L 8 0 Z"
                                          Width="8"
                                          Height="4"
                                          Margin="8,0,0,0"
                                          Fill="{DynamicResource OutlookHeaderForegroundBrush}"
                                          VerticalAlignment="Center" />
                                </StackPanel>
                            </materialDesign:PopupBox.ToggleContent>


                            <StackPanel>
                                <Button Command="{Binding OpenSettingsCommand}"
                                        HorizontalContentAlignment="Left"
                                        Style="{StaticResource MaterialDesignFlatSecondaryButton}">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Cog"
                                                                 Width="20"
                                                                 Height="20"
                                                                 Margin="0,0,8,0" />
                                        <TextBlock Text="Settings"
                                                   Style="{StaticResource MaterialDesignBody1TextBlock}" />
                                    </StackPanel>
                                </Button>
                                <Separator Margin="0,4,0,8"
                                           Background="#E1E1E1"
                                           Height="1" />
                                <Button Command="{Binding AuthorizationVM.SignOutCommand}"
                                        HorizontalContentAlignment="Left"
                                        Style="{StaticResource MaterialDesignFlatSecondaryButton}">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="AccountSwitch"
                                                                 Width="20"
                                                                 Height="20"
                                                                 Margin="0,0,8,0" />
                                        <TextBlock Text="Change Account"
                                                   Style="{StaticResource MaterialDesignBody1TextBlock}" />
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                        </materialDesign:PopupBox>
                    </Grid>
                </Border>

                <!--Main Body Section-->
                <Grid Grid.Row="1">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*" />
                            <RowDefinition Height="auto" />
                        </Grid.RowDefinitions>
                        <!--Main Body Top Section Show Tasks-->
                        <Grid Grid.Row="0"
                              Margin="8">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>
                                <!--Show Tasks Progress Bar-->
                                <Grid Grid.Row="0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="0.8*" />
                                        <ColumnDefinition Width="0.2*" />
                                    </Grid.ColumnDefinitions>
                                    <ProgressBar Grid.Column="0"
                                                 Maximum="100"
                                                 Height="32"
                                                 Value="{Binding ToDoListVM.CompletedTasks, Mode=OneWay}"
                                                 Foreground="{DynamicResource OutlookAccentBrush}"
                                                 Background="{DynamicResource OutlookProgressTrackBrush}"
                                                 BorderBrush="Transparent"
                                                 BorderThickness="0"
                                                 Margin="8,0" />

                                    <TextBlock Grid.Column="0"
                                               Text="{Binding ToDoListVM.CompletedTasks, Mode=OneWay,StringFormat={}{0:0}%}"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               Foreground="{DynamicResource OutlookHeaderForegroundBrush}"
                                               FontWeight="SemiBold"
                                               FontSize="16" />

                                    <Button Command="{Binding ToDoListVM.CleanUpCommand}"
                                            CommandParameter="{Binding ToDoListVM.ToDoList}"
                                            Margin="8,0"
                                            Grid.Column="1"
                                            ToolTip="Clear all completed/failed tasks"
                                            Style="{DynamicResource OutlookSecondaryButtonStyle}"
                                            Content="Clean Up">
                                    </Button>
                                </Grid>
                                <!--Show DataGrid Tasks-->
                                <Grid Grid.Row="1"
                                      Margin="8"
                                      HorizontalAlignment="Stretch">

                                    <DataGrid ItemsSource="{Binding ToDoListVM.ToDoList}"
                                              AutoGenerateColumns="False"
                                              SelectionMode="Single"
                                              SelectionUnit="FullRow"
                                              IsReadOnly="True"
                                              HeadersVisibility="Column"
                                              GridLinesVisibility="None"
                                              Focusable="False">

                                        <DataGrid.Columns>
                                            <!--Complete Checkbox-->
                                            <DataGridTemplateColumn Header="Done"
                                                                    Width="Auto"
                                                                    SortMemberPath="IsComplete">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <CheckBox IsChecked="{Binding IsComplete, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                                  VerticalAlignment="Center"
                                                                  HorizontalAlignment="Center">
                                                            <CheckBox.Style>
                                                                <Style TargetType="CheckBox">
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding Status}"
                                                                                     Value="Failed">
                                                                            <Setter Property="IsEnabled"
                                                                                    Value="False" />
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </CheckBox.Style>
                                                        </CheckBox>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <!--Task Title,Description-->
                                            <DataGridTemplateColumn Header="Task"
                                                                    Width="*">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <StackPanel Margin="4">
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="Auto" />
                                                                    <ColumnDefinition Width="*" />
                                                                </Grid.ColumnDefinitions>

                                                                <!-- Calendar icon, shown only if its an event -->
                                                                <materialDesign:PackIcon Kind="CalendarCheck"
                                                                                         Grid.Column="0"
                                                                                         Margin="0,2,4,0"
                                                                                         VerticalAlignment="Center"
                                                                                         ToolTip="Microsoft Event"
                                                                                         Visibility="{Binding EventId, Converter={StaticResource StringToVisibilityHiddenConverter}}" />

                                                                <!-- Task Title -->
                                                                <TextBlock Grid.Column="1"
                                                                           Text="{Binding Title}"
                                                                           TextWrapping="Wrap"
                                                                           VerticalAlignment="Center"
                                                                           FontWeight="SemiBold"
                                                                           Margin="0"
                                                                           Style="{StaticResource TitleTextStyle }" />
                                                            </Grid>

                                                            <!-- Task Description -->
                                                            <TextBlock Text="{Binding Description}"
                                                                       TextWrapping="Wrap"
                                                                       VerticalAlignment="Top"
                                                                       Margin="20,2,0,0"
                                                                       Visibility="{Binding Description, Converter={StaticResource StringToVisibilityCollapsedConverter}}"
                                                                       Style="{StaticResource DescriptionTextStyle}" />
                                                        </StackPanel>

                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <!--Task Priority-->
                                            <DataGridTemplateColumn Header="Priority"
                                                                    Width="Auto"
                                                                    SortMemberPath="prioritySortOrder">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding Importance}"
                                                                   HorizontalAlignment="Center"
                                                                   VerticalAlignment="Center"
                                                                   Style="{StaticResource TitleTextStyle}">
                                                        </TextBlock>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <!--Task Due Date-->
                                            <DataGridTemplateColumn Header="Due Date"
                                                                    Width="Auto"
                                                                    SortMemberPath="DueDate">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding DueDate, StringFormat='{}{0:dd-MM-yyyy}'}"
                                                                   Style="{StaticResource TitleTextStyle }"
                                                                   HorizontalAlignment="Center"
                                                                   VerticalAlignment="Center" />
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            
                                            <!--Remove Button-->
                                            <DataGridTemplateColumn Header=""
                                                                    Width="Auto"
                                                                    MinWidth="36">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <Button Command="{Binding DataContext.ToDoListVM.RemoveTaskCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                                CommandParameter="{Binding}"
                                                                Style="{StaticResource IconButtonStyle}">
                                                            <Image Source="pack://application:,,,/Assets/Icons/RemoveTask.png" 
                                                                   RenderOptions.BitmapScalingMode="HighQuality" />

                                                        </Button>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                        </DataGrid.Columns>
                                    </DataGrid>

                                </Grid>
                            </Grid>
                        </Grid>
                        <!--Main Body Bottom Section Add New Task-->
                        <Border Grid.Row="1"
                                CornerRadius="0"
                                Background="{DynamicResource OutlookHeaderBackgroundBrush}"
                                Padding="8 4">
                            <Grid HorizontalAlignment="Center">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <Button Style="{DynamicResource OutlookSecondaryButtonStyle}"
                                        Command="{Binding NewTaskCommand}">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Plus"
                                                                 Width="18"
                                                                 Height="18"
                                                                 Margin="0 0 6 0" />
                                        <TextBlock Text="Add New Task"
                                                   VerticalAlignment="Center" />
                                    </StackPanel>
                                </Button>
                            </Grid>
                        </Border>
                    </Grid>
                </Grid>
            </Grid>
        </materialDesign:DialogHost>
        </Grid>
    </Border>
</Window>
